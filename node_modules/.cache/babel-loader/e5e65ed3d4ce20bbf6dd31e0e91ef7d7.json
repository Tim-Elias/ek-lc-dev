{"ast":null,"code":"var _jsxFileName = \"/home/saint/123/ek-lc-dev/src/m_screen/foto.js\";\nimport React from 'react';\nimport CameraPhoto, { FACING_MODES } from 'jslib-html5-camera-photo';\nimport { connect } from 'react-redux';\nimport './mobile.css';\nimport foto from '../common/foto.png';\nimport { get_data } from './../common/common_modules'; //import Sound from 'react-sound';\n\nimport fotoSound from './../common/funk.mp3';\n\nclass Screen extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this.foto_sound_play = () => {//this.props.storage_reciept_set_foto_sound(Sound.status.PLAYING);\n    };\n\n    this.foto_sound_stop = () => {// this.props.storage_reciept_set_foto_sound(Sound.status.STOPPED);\n    };\n\n    this.cameraPhoto = null;\n    this.videoRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.cameraPhoto = new CameraPhoto(this.videoRef.current);\n  }\n\n  startCamera(idealFacingMode, idealResolution) {\n    this.cameraPhoto.startCamera(idealFacingMode, idealResolution).then(() => {\n      console.log('camera is started !');\n    }).catch(error => {\n      console.error('Camera not started!', error);\n    });\n    this.props.camera_active(true);\n  }\n\n  takePhoto() {\n    const config = {\n      sizeFactor: 1\n    };\n    let dataUri = this.cameraPhoto.getDataUri(config);\n    console.log(dataUri);\n    this.props.take_foto(dataUri);\n    this.foto_sound_play();\n    this.stopCamera();\n  }\n\n  stopCamera() {\n    this.foto_sound_stop();\n    this.props.camera_active(false);\n    this.cameraPhoto.stopCamera().then(() => {\n      console.log('Camera stoped!');\n    }).catch(error => {\n      console.log('No camera to stop!:', error);\n    });\n  }\n\n  send() {\n    let foto = {\n      img: this.props.store.disp.foto\n    };\n    get_data('testimg', foto).then(result => {\n      if (result == 'ok') {\n        alert('Данные отправленны');\n      } else {\n        alert('Ошибка');\n        console.log(result);\n      }\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"mobile_container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"mobile_button_container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: this.props.store.disp.cameraActive || this.props.store.disp.foto ? 'none' : 'camera_button',\n      onClick: () => {\n        let facingMode = FACING_MODES.ENVIRONMENT;\n        let idealResolution = {\n          width: 640,\n          height: 640\n        };\n        this.props.camera_active(true);\n        this.startCamera(facingMode, idealResolution);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }, \"\\u0412\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u044C \\u041A\\u0430\\u043C\\u0435\\u0440\\u0443\"), React.createElement(\"button\", {\n      className: this.props.store.disp.cameraActive ? 'camera_button' : 'none',\n      onClick: () => {\n        this.stopCamera();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, \"\\u0412\\u044B\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u044C \\u041A\\u0430\\u043C\\u0435\\u0440\\u0443\"), React.createElement(\"button\", {\n      className: this.props.store.disp.foto ? 'camera_button' : 'none',\n      onClick: () => {\n        let facingMode = FACING_MODES.ENVIRONMENT;\n        let idealResolution = {\n          width: 1280,\n          height: 1280\n        };\n        this.props.take_foto('');\n        this.props.camera_active(true);\n        this.startCamera(facingMode, idealResolution);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, \"\\u041F\\u0435\\u0440\\u0435\\u0441\\u043D\\u044F\\u0442\\u044C\")), React.createElement(\"div\", {\n      className: this.props.store.disp.cameraActive ? \"video_container\" : \"none\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, React.createElement(\"video\", {\n      className: this.props.store.disp.cameraActive ? \"foto\" : \"none\",\n      ref: this.videoRef,\n      autoPlay: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      className: this.props.store.disp.cameraActive ? \"video_button\" : \"none\",\n      src: foto,\n      onClick: () => {\n        this.takePhoto();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    })), React.createElement(\"img\", {\n      className: \"foto\",\n      src: this.props.store.disp.foto,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      onClick: this.send.bind(this),\n      className: this.props.store.disp.foto ? 'camera_button' : 'none',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"));\n  }\n\n}\n\nexport default connect(state => ({\n  store: state\n}), dispatch => ({\n  take_foto: param => {\n    dispatch({\n      type: 'set_disp_foto',\n      payload: param\n    });\n  },\n  camera_active: param => {\n    dispatch({\n      type: 'set_camera_active',\n      payload: param\n    });\n  },\n  storage_reciept_set_foto_sound: param => {\n    dispatch({\n      type: 'set_foto_sound',\n      payload: param\n    });\n  }\n}))(Screen);","map":{"version":3,"sources":["/home/saint/123/ek-lc-dev/src/m_screen/foto.js"],"names":["React","CameraPhoto","FACING_MODES","connect","foto","get_data","fotoSound","Screen","Component","constructor","props","context","foto_sound_play","foto_sound_stop","cameraPhoto","videoRef","createRef","componentDidMount","current","startCamera","idealFacingMode","idealResolution","then","console","log","catch","error","camera_active","takePhoto","config","sizeFactor","dataUri","getDataUri","take_foto","stopCamera","send","img","store","disp","result","alert","render","cameraActive","facingMode","ENVIRONMENT","width","height","bind","state","dispatch","param","type","payload","storage_reciept_set_foto_sound"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,IAAsBC,YAAtB,QAA0C,0BAA1C;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAO,cAAP;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,SAASC,QAAT,QAAyB,4BAAzB,C,CACA;;AACA,OAAOC,SAAP,MAAsB,sBAAtB;;AAEA,MAAMC,MAAN,SAAqBP,KAAK,CAACQ,SAA3B,CAAqC;AACjCC,EAAAA,WAAW,CAACC,KAAD,EAAQC,OAAR,EAAiB;AACxB,UAAMD,KAAN,EAAaC,OAAb;;AADwB,SAO5BC,eAP4B,GAOV,MAAM,CACpB;AACH,KAT2B;;AAAA,SAW5BC,eAX4B,GAWV,MAAM,CACrB;AACF,KAb2B;;AAGxB,SAAKC,WAAL,GAAmB,IAAnB;AACA,SAAKC,QAAL,GAAgBf,KAAK,CAACgB,SAAN,EAAhB;AACH;;AAUDC,EAAAA,iBAAiB,GAAG;AAChB,SAAKH,WAAL,GAAmB,IAAIb,WAAJ,CAAgB,KAAKc,QAAL,CAAcG,OAA9B,CAAnB;AACH;;AAEDC,EAAAA,WAAW,CAACC,eAAD,EAAkBC,eAAlB,EAAmC;AAE1C,SAAKP,WAAL,CAAiBK,WAAjB,CAA6BC,eAA7B,EAA8CC,eAA9C,EACKC,IADL,CACU,MAAM;AACRC,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACH,KAHL,EAIKC,KAJL,CAIYC,KAAD,IAAW;AACdH,MAAAA,OAAO,CAACG,KAAR,CAAc,qBAAd,EAAqCA,KAArC;AACH,KANL;AAQA,SAAKhB,KAAL,CAAWiB,aAAX,CAAyB,IAAzB;AACH;;AAEDC,EAAAA,SAAS,GAAG;AACR,UAAMC,MAAM,GAAG;AACXC,MAAAA,UAAU,EAAE;AADD,KAAf;AAGA,QAAIC,OAAO,GAAG,KAAKjB,WAAL,CAAiBkB,UAAjB,CAA4BH,MAA5B,CAAd;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAYO,OAAZ;AACA,SAAKrB,KAAL,CAAWuB,SAAX,CAAqBF,OAArB;AACA,SAAKnB,eAAL;AACA,SAAKsB,UAAL;AACH;;AAEDA,EAAAA,UAAU,GAAG;AACT,SAAKrB,eAAL;AACA,SAAKH,KAAL,CAAWiB,aAAX,CAAyB,KAAzB;AACA,SAAKb,WAAL,CAAiBoB,UAAjB,GACKZ,IADL,CACU,MAAM;AACRC,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACH,KAHL,EAIKC,KAJL,CAIYC,KAAD,IAAW;AACdH,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCE,KAAnC;AACH,KANL;AAOH;;AAEDS,EAAAA,IAAI,GAAG;AACH,QAAI/B,IAAI,GAAG;AACPgC,MAAAA,GAAG,EAAE,KAAK1B,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBlC;AADpB,KAAX;AAGAC,IAAAA,QAAQ,CAAC,SAAD,EAAYD,IAAZ,CAAR,CAA0BkB,IAA1B,CACKiB,MAAD,IAAY;AACR,UAAGA,MAAM,IAAI,IAAb,EAAmB;AACfC,QAAAA,KAAK,CAAC,oBAAD,CAAL;AACH,OAFD,MAEO;AACHA,QAAAA,KAAK,CAAC,QAAD,CAAL;AACAjB,QAAAA,OAAO,CAACC,GAAR,CAAYe,MAAZ;AACH;AACJ,KARL;AAUH;;AAEDE,EAAAA,MAAM,GAAG;AAEL,WACI;AAAK,MAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,yBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,MAAA,SAAS,EAAE,KAAK/B,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBI,YAAtB,IAAsC,KAAKhC,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBlC,IAA5D,GAAmE,MAAnE,GAA4E,eAA/F;AAAgH,MAAA,OAAO,EAAE,MAAM;AAC3H,YAAIuC,UAAU,GAAGzC,YAAY,CAAC0C,WAA9B;AACA,YAAIvB,eAAe,GAAG;AAAEwB,UAAAA,KAAK,EAAE,GAAT;AAAcC,UAAAA,MAAM,EAAE;AAAtB,SAAtB;AACA,aAAKpC,KAAL,CAAWiB,aAAX,CAAyB,IAAzB;AACA,aAAKR,WAAL,CAAiBwB,UAAjB,EAA6BtB,eAA7B;AACH,OALD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+FADJ,EAQI;AAAQ,MAAA,SAAS,EAAE,KAAKX,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBI,YAAtB,GAAqC,eAArC,GAAuD,MAA1E;AAAkF,MAAA,OAAO,EAAE,MAAM;AAC7F,aAAKR,UAAL;AACH,OAFD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qGARJ,EAYI;AAAQ,MAAA,SAAS,EAAE,KAAKxB,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBlC,IAAtB,GAA6B,eAA7B,GAA+C,MAAlE;AAA0E,MAAA,OAAO,EAAE,MAAM;AACrF,YAAIuC,UAAU,GAAGzC,YAAY,CAAC0C,WAA9B;AACA,YAAIvB,eAAe,GAAG;AAAEwB,UAAAA,KAAK,EAAE,IAAT;AAAeC,UAAAA,MAAM,EAAE;AAAvB,SAAtB;AACA,aAAKpC,KAAL,CAAWuB,SAAX,CAAqB,EAArB;AACA,aAAKvB,KAAL,CAAWiB,aAAX,CAAyB,IAAzB;AACA,aAAKR,WAAL,CAAiBwB,UAAjB,EAA6BtB,eAA7B;AACH,OAND;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAZJ,CADJ,EAsBI;AAAK,MAAA,SAAS,EAAE,KAAKX,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBI,YAAtB,GAAqC,iBAArC,GAAyD,MAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAO,MAAA,SAAS,EAAE,KAAKhC,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBI,YAAtB,GAAqC,MAArC,GAA8C,MAAhE;AAAwE,MAAA,GAAG,EAAE,KAAK3B,QAAlF;AAA4F,MAAA,QAAQ,EAAI,IAAxG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAGI;AAAK,MAAA,SAAS,EAAE,KAAKL,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBI,YAAtB,GAAqC,cAArC,GAAsD,MAAtE;AAA8E,MAAA,GAAG,EAAEtC,IAAnF;AAAyF,MAAA,OAAO,EAAE,MAAM;AAAC,aAAKwB,SAAL;AAAiB,OAA1H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHJ,CAtBJ,EA4BI;AACI,MAAA,SAAS,EAAC,MADd;AAEI,MAAA,GAAG,EAAE,KAAKlB,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBlC,IAF/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA5BJ,EAiCI;AAAQ,MAAA,OAAO,EAAE,KAAK+B,IAAL,CAAUY,IAAV,CAAe,IAAf,CAAjB;AAAuC,MAAA,SAAS,EAAE,KAAKrC,KAAL,CAAW2B,KAAX,CAAiBC,IAAjB,CAAsBlC,IAAtB,GAA6B,eAA7B,GAA+C,MAAjG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAjCJ,CADJ;AAqCH;;AA/GgC;;AAkHrC,eAAeD,OAAO,CACjB6C,KAAD,KAAY;AAAEX,EAAAA,KAAK,EAAEW;AAAT,CAAZ,CADkB,EAElBC,QAAQ,KAAK;AACThB,EAAAA,SAAS,EAAGiB,KAAD,IAAW;AAAED,IAAAA,QAAQ,CAAC;AAAEE,MAAAA,IAAI,EAAE,eAAR;AAAyBC,MAAAA,OAAO,EAAEF;AAAlC,KAAD,CAAR;AAAqD,GADpE;AAETvB,EAAAA,aAAa,EAAGuB,KAAD,IAAW;AAAED,IAAAA,QAAQ,CAAC;AAAEE,MAAAA,IAAI,EAAE,mBAAR;AAA6BC,MAAAA,OAAO,EAAEF;AAAtC,KAAD,CAAR;AAAyD,GAF5E;AAGTG,EAAAA,8BAA8B,EAAGH,KAAD,IAAW;AAAED,IAAAA,QAAQ,CAAC;AAAEE,MAAAA,IAAI,EAAE,gBAAR;AAA0BC,MAAAA,OAAO,EAAEF;AAAnC,KAAD,CAAR;AAAsD;AAH1F,CAAL,CAFU,CAAP,CAOb3C,MAPa,CAAf","sourcesContent":["import React from 'react';\nimport CameraPhoto, { FACING_MODES } from 'jslib-html5-camera-photo';\nimport { connect } from 'react-redux';\nimport './mobile.css';\nimport foto from '../common/foto.png';\nimport { get_data } from './../common/common_modules';\n//import Sound from 'react-sound';\nimport fotoSound from './../common/funk.mp3';\n\nclass Screen extends React.Component {\n    constructor(props, context) {\n        super(props, context);\n\n        this.cameraPhoto = null;\n        this.videoRef = React.createRef();\n    }\n\n    foto_sound_play = () => {\n        //this.props.storage_reciept_set_foto_sound(Sound.status.PLAYING);\n    }\n\n    foto_sound_stop = () => {\n       // this.props.storage_reciept_set_foto_sound(Sound.status.STOPPED);\n    }\n\n    componentDidMount() {\n        this.cameraPhoto = new CameraPhoto(this.videoRef.current);\n    }\n\n    startCamera(idealFacingMode, idealResolution) {\n\n        this.cameraPhoto.startCamera(idealFacingMode, idealResolution)\n            .then(() => {\n                console.log('camera is started !');\n            })\n            .catch((error) => {\n                console.error('Camera not started!', error);\n            });\n        \n        this.props.camera_active(true);\n    }\n\n    takePhoto() {\n        const config = {\n            sizeFactor: 1\n        };\n        let dataUri = this.cameraPhoto.getDataUri(config);\n        console.log(dataUri);\n        this.props.take_foto(dataUri);\n        this.foto_sound_play();\n        this.stopCamera();\n    }\n\n    stopCamera() {\n        this.foto_sound_stop();\n        this.props.camera_active(false);\n        this.cameraPhoto.stopCamera()\n            .then(() => {\n                console.log('Camera stoped!');\n            })\n            .catch((error) => {\n                console.log('No camera to stop!:', error);\n            });\n    }\n\n    send() {\n        let foto = { \n            img: this.props.store.disp.foto,\n        };\n        get_data('testimg', foto).then(\n            (result) => {\n                if(result == 'ok') {\n                    alert('Данные отправленны');\n                } else {\n                    alert('Ошибка');\n                    console.log(result);\n                }\n            }\n        )\n    }\n\n    render() {\n\n        return (\n            <div className=\"mobile_container\">\n                <div className=\"mobile_button_container\">\n                    <button className={this.props.store.disp.cameraActive || this.props.store.disp.foto ? 'none' : 'camera_button'} onClick={() => {\n                        let facingMode = FACING_MODES.ENVIRONMENT;\n                        let idealResolution = { width: 640, height: 640 };\n                        this.props.camera_active(true);\n                        this.startCamera(facingMode, idealResolution);\n                    }}>Включить Камеру</button>\n\n                    <button className={this.props.store.disp.cameraActive ? 'camera_button' : 'none'} onClick={() => {\n                        this.stopCamera();\n                    }}>Выключить Камеру</button>\n\n                    <button className={this.props.store.disp.foto ? 'camera_button' : 'none'} onClick={() => {\n                        let facingMode = FACING_MODES.ENVIRONMENT;\n                        let idealResolution = { width: 1280, height: 1280 };\n                        this.props.take_foto('');\n                        this.props.camera_active(true);\n                        this.startCamera(facingMode, idealResolution);\n                    }}>Переснять</button>\n                </div>\n\n                <div className={this.props.store.disp.cameraActive ? \"video_container\" : \"none\"}>\n                    <video className={this.props.store.disp.cameraActive ? \"foto\" : \"none\"} ref={this.videoRef} autoPlay = {true}/>\n                    \n                    <img className={this.props.store.disp.cameraActive ? \"video_button\" : \"none\"} src={foto} onClick={() => {this.takePhoto()}} />\n\n                </div>\n                <img\n                    className=\"foto\"\n                    src={this.props.store.disp.foto}\n                />\n\n                <button onClick={this.send.bind(this)} className={this.props.store.disp.foto ? 'camera_button' : 'none'}>Отправить</button>\n            </div>\n        );\n    }\n} \n\nexport default connect(\n    (state) => ({ store: state }),\n    dispatch => ({\n        take_foto: (param) => { dispatch({ type: 'set_disp_foto', payload: param }) },\n        camera_active: (param) => { dispatch({ type: 'set_camera_active', payload: param }) },\n        storage_reciept_set_foto_sound: (param) => { dispatch({ type: 'set_foto_sound', payload: param }) },\n    })\n)(Screen);"]},"metadata":{},"sourceType":"module"}